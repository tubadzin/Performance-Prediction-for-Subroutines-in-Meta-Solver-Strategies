
%addpath(genpath(pwd))
used_instance_idxs = ones(1 , 329);
all_instance_features = ones(1,0);
cens = zeros(329,1);
thetaCat = [];
thetaDomains = {[],[],[],[]};
xCat = [];
xCatDomains = cell(1,0);
isclean = 0;
algo_deterministic = 0;
al_opts = get_rf_default_options;
names = {};

model = learnMarginalModel(Theta, used_instance_idxs, all_instance_features, y, cens, thetaCat, thetaDomains, xCat, xCatDomains, isclean, algo_deterministic, al_opts, names);


thetaTest = Theta;
instanceFeatures = all_instance_features;

[yPred1, yPredVar1] = compute_from_leaves(model.module, thetaTest, instanceFeatures, model.algo_deterministic);

observationNoise = 0;
joint = 0;

[yPred, yPredVar, samples_of_min] = applyMarginalModel(model, thetaTest, instanceFeatures, isclean, observationNoise, joint);
idx = find(min(yPredVar,yPredVar1)<0.01)
[yPredVar(idx)-yPredVar1(idx)]
yPredVar1-yPredVar


% Can only do the following on the command line!


% y = [   0.1000
%    0.0200
%    0.0300
%    0.1000
%    0.1900
%    0.9600
%    0.0400
%    0.4500
%    0.1300
%    0.0600
%    0.0300
%    0.1000
%    0.1500
%    0.0700
%    0.3400
%    0.0200
%    0.0300
%    0.0900
%    0.0700
%    0.0300
%    0.0900
%    0.0300
%    0.0900
%    0.1600
%    0.0900
%    0.0200
%    0.0200
%    0.0800
%    0.1000
%    0.1500
%    0.1200
%    0.0500
%    0.0700
%    0.0500
%    0.5000
%    0.0500
%    0.2900
%    0.0700
%    0.3300
%    0.0400
%    0.1000
%    0.0400
%    0.0500
%    0.4500
%    0.1900
%    0.1100
%    0.0700
%    0.0700
%    0.1400
%    0.0500
%    0.0300
%    0.0800
%    0.0500
%    0.0300
%    0.0400
%    0.2500
%    0.0300
%    0.0900
%    0.0700
%    0.0600
%    0.1600
%    0.0800
%    0.2100
%    0.0500
%    0.0800
%    0.0400
%    0.0700
%    0.0300
%    0.0300
%    0.0700
%    0.0300
%    0.0500
%    0.1400
%    0.0400
%    0.0400
%    0.0700
%    0.0400
%    0.0500
%    0.1500
%    0.0400
%    0.1000
%    0.1000
%    0.0600
%    0.1200
%    0.1300
%    0.0400
%    0.0800
%    0.0400
%    0.0400
%    0.0400
%    0.0500
%    0.0400
%    0.0500
%    0.1000
%    0.0400
%    0.0500
%    0.0300
%    0.0300
%    0.1000
%    0.0300
%    0.0200
%    0.0600
%    0.0500
%    0.0500
%    0.0700
%    0.0600
%    0.1000
%    0.0400
%    0.0400
%    0.0600
%    0.0700
%    0.0900
%    0.1500
%    0.0800
%    0.0500
%    0.0700
%    0.0400
%    0.1800
%    0.1300
%    5.0000
%    0.0300
%    0.0700
%    0.0300
%    0.0500
%    0.0700
%    0.0500
%    0.0800
%    0.0600
%    0.1000
%    0.0300
%    0.0600
%    0.1000
%    0.0400
%    0.0600
%    0.2100
%    0.2600
%    0.0500
%    0.0600
%    0.0700
%    0.0700
%    0.0400
%    0.0500
%    0.0600
%    0.0300
%    0.0500
%    0.0400
%    0.0200
%    0.1200
%    0.0400
%    0.0600
%    0.0500
%    0.0500
%    0.0600
%    0.0700
%    0.0400
%    0.1000
%    0.1400
%    0.1500
%    0.0400
%    0.0700
%    0.0500
%    0.0400
%    0.0700
%    0.0700
%    0.0500
%    0.0900
%    0.0400
%    0.1800
%    0.0500
%    0.0200
%    0.0300
%    0.0400
%    0.2400
%    0.0300
%    0.0500
%    0.0700
%    0.0600
%    0.1000
%    0.1000
%    0.0800
%    0.0500
%    0.0700
%    0.1500
%    0.2200
%    0.0300
%    0.7600
%    0.1100
%    0.0400
%    0.1600
%    0.0700
%    0.0300
%    0.1300
%    0.0200
%    0.3900
%    0.0400
%    0.2700
%    0.1000
%    0.1600
%    0.0600
%    0.0900
%    0.1400
%    0.0600
%    0.1000
%    0.0500
%    0.0900
%    0.1800
%    0.1900
%    0.1400
%    0.0300
%    0.0500
%    0.0700
%    0.0800
%    0.0200
%    0.0800
%    0.0500
%    0.1700
%    0.0300
%    0.4800
%    0.0300
%    0.5500
%    0.0700
%    0.1000
%    0.0300
%    0.1700
%    0.0600
%    0.1400
%    0.0900
%    0.0400
%    0.0600
%    0.0700
%    0.3100
%    0.2900
%    0.1400
%    0.1900
%    0.0500
%    0.0400
%    0.0800
%    0.0700
%    0.0500
%    0.0500
%    0.0600
%    0.0800
%    0.0500
%    0.0300
%    0.0500
%    0.0500
%    0.0400
%    0.0600
%    0.0700
%    0.0800
%    0.0500
%    0.0700
%    0.0200
%    0.1400
%    0.0800
%    0.0700
%    0.0500
%    0.0900
%    0.0500
%    0.0500
%    0.0500
%    0.0300
%    0.1400
%    0.0500
%    0.0900
%    0.0800
%    0.0300
%    0.0800
%    0.0900
%    0.1500
%    0.0400
%    0.0300
%    0.0700
%    0.0700
%    0.0600
%    0.0900
%    0.0700
%    0.0300
%    0.1400
%    0.1300
%    0.0400
%    0.0800
%    0.0900
%    0.0400
%    0.1300
%    0.1000
%    0.1300
%    0.1400
%    0.1100
%    0.0400
%    0.0700
%    0.1300
%    0.0500
%    0.0200
%    0.1900
%    0.0300
%    0.2900
%    0.0300
%    0.1900
%    0.0700
%    0.2100
%    0.0200
%    0.1000
%    0.0400
%    0.1500
%    0.0300
%    0.0700
%    0.0600
%    0.0300
%    0.0500
%    0.1900
%    0.0400
%    0.2900
%    0.0400
%    0.0400
%    0.1200
%    0.2300
%    0.0500
%    0.5600
%    0.2100
%    0.0600
%    0.0600
%    0.2300
%    0.0300
%    0.3100
%    0.0500
%    0.0900
%    0.1100
%    0.0900];
% 
% Theta = [
%    0.1731    0.1000    0.5000    0.0300
%    0.1731    0.1000    0.5000    0.0300
%    0.2703    0.1155    0.3431    0.0198
%    0.2703    0.1155    0.3431    0.0198
%    0.1731    0.1000    0.5000    0.0300
%    0.3225    0.0947    0.8701    0.0084
%    0.1731    0.1000    0.5000    0.0300
%    0.0878    0.0002    0.3390    0.0233
%    0.1731    0.1000    0.5000    0.0300
%    0.2715    0.1441    0.6789    0.0312
%    0.2715    0.1441    0.6789    0.0312
%    0.2715    0.1441    0.6789    0.0312
%    0.2715    0.1441    0.6789    0.0312
%    0.2715    0.1441    0.6789    0.0312
%    0.2715    0.1441    0.6789    0.0312
%    0.2804    0.1155    0.3431    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2748    0.0743    0.2501    0.0023
%    0.2804    0.1155    0.3431    0.0198
%    0.2914    0.1472    0.3591    0.0300
%    0.2804    0.1155    0.3431    0.0198
%    0.1985    0.0643    0.1975    0.0218
%    0.1985    0.0643    0.1975    0.0218
%    0.1985    0.0643    0.1975    0.0218
%    0.2804    0.1155    0.3431    0.0198
%    0.2966    0.1237    0.3737    0.0503
%    0.2804    0.1155    0.3431    0.0198
%    0.3078    0.1135    0.1191    0.0204
%    0.2804    0.1155    0.3431    0.0198
%    0.2543    0.0498    0.8732    0.0509
%    0.2804    0.1155    0.3431    0.0198
%    0.3097    0.0473    0.2271    0.0225
%    0.2804    0.1155    0.3431    0.0198
%    0.3163    0.0913    0.4428    0.0184
%    0.2804    0.1155    0.3431    0.0198
%    0.1659    0.1509    0.0827    0.0555
%    0.2804    0.1155    0.3431    0.0198
%    0.3164    0.0754    0.2217    0.0198
%    0.3164    0.0754    0.2217    0.0198
%    0.3164    0.0754    0.2217    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.2767    0.0960    0.1571    0.0198
%    0.2804    0.1155    0.3431    0.0198
%    0.1974    0.1183    0.8409    0.0158
%    0.2804    0.1155    0.3431    0.0198
%    0.2443    0.0962    0.4499    0.0218
%    0.2443    0.0962    0.4499    0.0218
%    0.2443    0.0962    0.4499    0.0218
%    0.2443    0.0962    0.4499    0.0218
%    0.2443    0.0962    0.4499    0.0218
%    0.2443    0.0962    0.4499    0.0218
%    0.2443    0.0962    0.4499    0.0218
%    0.2804    0.1155    0.3431    0.0198
%    0.2612    0.0947    0.1645    0.0219
%    0.2804    0.1155    0.3431    0.0198
%    0.0452    0.1169    0.0603    0.0306
%    0.2804    0.1155    0.3431    0.0198
%    0.3081    0.0947    0.3894    0.0024
%    0.2804    0.1155    0.3431    0.0198
%    0.3203    0.0957    0.1038    0.0202
%    0.2804    0.1155    0.3431    0.0198
%    0.2198    0.0024    0.6695    0.0202
%    0.2804    0.1155    0.3431    0.0198
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.3189    0.1806    0.0552    0.0001
%    0.2804    0.1155    0.3431    0.0198
%    0.3216    0.1045    0.2663    0.0065
%    0.2804    0.1155    0.3431    0.0198
%    0.0911    0.1324    0.4984    0.0059
%    0.2804    0.1155    0.3431    0.0198
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1837    0.0621    0.0011
%    0.3223    0.1851    0.6270    0.0375
%    0.3223    0.1837    0.0621    0.0011
%    0.0244    0.1916    0.1437    0.0192
%    0.3223    0.1837    0.0621    0.0011
%    0.1180    0.1857    0.1068    0.0178
%    0.3223    0.1837    0.0621    0.0011
%    0.2115    0.1798    0.3518    0.0589
%    0.2115    0.1798    0.3518    0.0589
%    0.2115    0.1798    0.3518    0.0589
%    0.2115    0.1798    0.3518    0.0589
%    0.2115    0.1798    0.3518    0.0589
%    0.2115    0.1798    0.3518    0.0589
%    0.2115    0.1798    0.3518    0.0589
%    0.3223    0.1837    0.0621    0.0011
%    0.0396    0.0790    0.0603    0.0217
%    0.3223    0.1837    0.0621    0.0011
%    0.2085    0.1886    0.1259    0.0372
%    0.3223    0.1837    0.0621    0.0011
%    0.0729    0.0457    0.7756    0.0109
%    0.3223    0.1837    0.0621    0.0011
%    0.2679    0.1886    0.4606    0.0345
%    0.2679    0.1886    0.4606    0.0345
%    0.2679    0.1886    0.4606    0.0345
%    0.3223    0.1837    0.0621    0.0011
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.2340    0.1901    0.1033    0.0178
%    0.3223    0.1837    0.0621    0.0011
%    0.2518    0.1904    0.3235    0.0427
%    0.2518    0.1904    0.3235    0.0427
%    0.2518    0.1904    0.3235    0.0427
%    0.2518    0.1904    0.3235    0.0427
%    0.2518    0.1904    0.3235    0.0427
%    0.2518    0.1904    0.3235    0.0427
%    0.2518    0.1904    0.3235    0.0427
%    0.3223    0.1837    0.0621    0.0011
%    0.1673    0.1905    0.1859    0.0374
%    0.3223    0.1837    0.0621    0.0011
%    0.2915    0.0682    0.9324    0.0451
%    0.3223    0.1837    0.0621    0.0011
%    0.0333    0.1671    0.1669    0.0517
%    0.3223    0.1837    0.0621    0.0011
%    0.0300    0.0541    0.0849    0.0084
%    0.0300    0.0541    0.0849    0.0084
%    0.0300    0.0541    0.0849    0.0084
%    0.3223    0.1837    0.0621    0.0011
%    0.1726    0.1217    0.4422    0.0236
%    0.3223    0.1837    0.0621    0.0011
%    0.0293    0.0876    0.1660    0.0196
%    0.3223    0.1837    0.0621    0.0011
%    0.2103    0.1909    0.0303    0.0423
%    0.3223    0.1837    0.0621    0.0011
%    0.0596    0.1178    0.8614    0.0175
%    0.3223    0.1837    0.0621    0.0011
%    0.2181    0.1911    0.1365    0.0501
%    0.3223    0.1837    0.0621    0.0011
%    0.1184    0.1912    0.0404    0.0445
%    0.1184    0.1912    0.0404    0.0445
%    0.1184    0.1912    0.0404    0.0445
%    0.3223    0.1837    0.0621    0.0011
%    0.2021    0.1418    0.4785    0.0039
%    0.3223    0.1837    0.0621    0.0011
%    0.0290    0.0041    0.0533    0.0548
%    0.3223    0.1837    0.0621    0.0011
%    0.2590    0.1954    0.4625    0.0224
%    0.2590    0.1954    0.4625    0.0224
%    0.2590    0.1954    0.4625    0.0224
%    0.2590    0.1954    0.4625    0.0224
%    0.2590    0.1954    0.4625    0.0224
%    0.2590    0.1954    0.4625    0.0224
%    0.2590    0.1954    0.4625    0.0224
%    0.3223    0.1837    0.0621    0.0011
%    0.3237    0.1809    0.8281    0.0446
%    0.3223    0.1837    0.0621    0.0011
%    0.0289    0.1054    0.1295    0.0197
%    0.3223    0.1837    0.0621    0.0011
%    0.2136    0.0200    0.6180    0.0072
%    0.3223    0.1837    0.0621    0.0011
%    0.0284    0.0020    0.6711    0.0008
%    0.3223    0.1837    0.0621    0.0011
%    0.0219    0.0110    0.9915    0.0537
%    0.3223    0.1837    0.0621    0.0011
%    0.0286    0.0576    0.6700    0.0182
%    0.0286    0.0576    0.6700    0.0182
%    0.0286    0.0576    0.6700    0.0182
%    0.0286    0.0576    0.6700    0.0182
%    0.0286    0.0576    0.6700    0.0182
%    0.0286    0.0576    0.6700    0.0182
%    0.0286    0.0576    0.6700    0.0182
%    0.3223    0.1837    0.0621    0.0011
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.1960    0.1858    0.1437    0.0349
%    0.3223    0.1837    0.0621    0.0011
%    0.0278    0.0101    0.0051    0.0522
%    0.3223    0.1837    0.0621    0.0011
%    0.0933    0.0646    0.2862    0.0549
%    0.3223    0.1837    0.0621    0.0011
%    0.0277    0.0404    0.3495    0.0387
%    0.3223    0.1837    0.0621    0.0011
%    0.0276    0.0782    0.4509    0.0032
%    0.3223    0.1837    0.0621    0.0011
%    0.0468    0.1659    0.6528    0.0309
%    0.3223    0.1837    0.0621    0.0011
%    0.0276    0.1332    0.5389    0.0136
%    0.3223    0.1837    0.0621    0.0011
%    0.2520    0.1583    0.3334    0.0028
%    0.3223    0.1837    0.0621    0.0011
%    0.1972    0.1914    0.1237    0.0181
%    0.1972    0.1914    0.1237    0.0181
%    0.1972    0.1914    0.1237    0.0181
%    0.3223    0.1837    0.0621    0.0011
%    0.0385    0.1420    0.5882    0.0557
%    0.3223    0.1837    0.0621    0.0011
%    0.2929    0.1913    0.3467    0.0192
%    0.2929    0.1913    0.3467    0.0192
%    0.2929    0.1913    0.3467    0.0192
%    0.3223    0.1837    0.0621    0.0011
%    0.0273    0.0026    0.0319    0.0526
%    0.3223    0.1837    0.0621    0.0011
%    0.2244    0.1656    0.5436    0.0014
%    0.2244    0.1656    0.5436    0.0014
%    0.2244    0.1656    0.5436    0.0014
%    0.3223    0.1837    0.0621    0.0011
%    0.0269    0.0744    0.7606    0.0060
%    0.3223    0.1837    0.0621    0.0011
%    0.1878    0.1586    0.0403    0.0516
%    0.3223    0.1837    0.0621    0.0011
%    0.0271    0.0727    0.1330    0.0201];
